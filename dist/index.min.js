var ShopCartConst;!function(t){t.STORAGE_CART="cart",t.STORAGE_UTM="utm",t.CLASS_BODY_CART_READY="cart-ready",t.CLASS_BODY_CART_OPEN="cart-open",t.CLASS_CART_ACTION="cart-action",t.CLASS_CART_EMPTY="empty",t.CLASS_CART_OPEN="open",t.SELECTOR_CART="#store-cart",t.SELECTOR_CART_ACTION=".cart-action",t.SELECTOR_CART_ITEM_LIST="#cart-item-list",t.SELECTOR_CART_TOTAL_PRICE=".cart-total-price",t.SELECTOR_CART_TOTAL_COUNT=".cart-total-count",t.ACTION_ADD="add",t.ACTION_REMOVE="remove",t.DATA_ACTION="action",t.DATA_UPC="upc",t.CLASS_ITEM_QUANTITY="quantity",t.CLASS_ITEM="cart-item",t.SELECTOR_ITEM_QUANTITY=".quantity",t.CLASS_ELEMENT_ACTIVE="active",t.SELECTOR_ELEMENT_CART_AREA=".cart-area",t.SELECTOR_ELEMENT_CART_NOTIFICATION=".cart-notification",t.PREFIX_CART_IMAGE="cart_",t.PREFIX_DATA="data-",t.PREFIX_ITEM="item-",t.ADD_EVT="shop-cart-add",t.REMOVE_EVT="shop-cart-remove",t.OPEN_EVT="shop-cart-open",t.CLOSE_EVT="shop-cart-close",t.INIT_EVT="shop-cart-init",t.READY_EVT="shop-cart-ready"}(ShopCartConst||(ShopCartConst={}));!function(t){t.CART_INVALID_BEFORE=1540803448e3;var e=function(){function e(t,e){void 0===e&&(e=null),e?this.init(e):(this.id=this.getId(),this.createdAt=(new Date).getTime(),this.currency=t,this.items=[],this.total=0,this.quantity=0)}return e.prototype.setItem=function(e){var i=!1,n=0;return this.items.map(function(t){return t.item.upc==e.upc&&(t.quantity++,i=!0,n=t.quantity),t}),i||(this.items.push(new t.CartItem(e,1)),n=1),n},e.prototype.removeItem=function(t){var e=0;return this.items.map(function(i){return i.item.upc==t.upc&&(i.quantity>0&&i.quantity--,e=i.quantity),i}),e},e.prototype.init=function(t){this.id=t.id,this.createdAt=t.createdAt,this.currency=t.currency,this.total=t.total,this.quantity=t.quantity,this.initItems(t.items)},e.prototype.initItems=function(e){this.items=[];for(var i=0;i<e.length;i++)this.items.push(new t.CartItem(e[i].item,e[i].quantity))},e.prototype.getId=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()+"-"+Date.now()},e}();t.Cart=e;var i=["id","createdAt","total",,"quantity","items","currency"];t.isValidCart=function(e){if(!e||!e.createdAt||e.createdAt<t.CART_INVALID_BEFORE)return!1;for(var n=!0,r=0;r<i.length;r++)n=n&&(!i[r]||void 0!==e[i[r]]);return n}}(ShopCart||(ShopCart={}));!function(t){var e=function(){function e(e){if(!e)throw new Error("Config is missing");this.store=new t.ConfigStore(e.store),this.image=new t.ConfigImage(e.image),this.currencies=e.currencies,this.currency=this.getDefaultCurrency(),this.products=e.products,this.selector=new t.ConfigSelector(e.selector),this.selectorClass=new t.ConfigSelectorClass(e.selectorClass)}return e.prototype.getDefaultCurrency=function(){if(!this.currencies||0==this.currencies.length)return{name:"United States Dollar",label:"USD",code:"USD",symbol:"$",default:!0};var t=this.currencies.filter(function(t){return t.default});return t&&0!=t.length?t[0]:this.currencies[0]},e}();t.Config=e;var i=function(){return function(t){if(!t)throw new Error("Store config is missing");this.name=t.name,this.url=t.url}}();t.ConfigStore=i;var n=function(){return function(t){void 0===t&&(t=null),this.basePath=t&&t.basePath?t.basePath:"./images/",this.lazyload=Boolean(t.lazyload)}}();t.ConfigImage=n;var r=function(){return function(e){void 0===e&&(e=null),e||(e={cart:null,body:"body",element:null}),this.cart=new t.ConfigSelectorCart(e.cart),this.body=e.body,this.element=new t.ConfigSelectorElement(e.element)}}();t.ConfigSelector=r;var a=function(){return function(e){void 0===e&&(e=null),e||(e={cart:null,body:null,element:null}),this.cart=new t.ConfigSelectorClassCart(e.cart),this.body=new t.ConfigSelectorClassBody(e.body),this.element=new t.ConfigSelectorClassElement(e.element)}}();t.ConfigSelectorClass=a;var o=function(){return function(t){void 0===t&&(t=null),this.main=t&&t.main?t.main:ShopCartConst.SELECTOR_CART,this.total=t&&t.total?t.total:ShopCartConst.SELECTOR_CART_TOTAL_PRICE,this.count=t&&t.count?t.count:ShopCartConst.SELECTOR_CART_TOTAL_COUNT}}();t.ConfigSelectorCart=o;var s=function(){return function(t){void 0===t&&(t=null),this.open=t&&t.open?t.open:ShopCartConst.CLASS_CART_OPEN,this.empty=t&&t.empty?t.empty:ShopCartConst.CLASS_CART_EMPTY}}();t.ConfigSelectorClassCart=s;var c=function(){return function(t){void 0===t&&(t=null),this.cartReady=t&&t.cartReady?t.cartReady:ShopCartConst.CLASS_BODY_CART_READY,this.cartOpen=t&&t.cartOpen?t.cartOpen:ShopCartConst.CLASS_BODY_CART_OPEN}}();t.ConfigSelectorClassBody=c;var u=function(){return function(t){void 0===t&&(t=null),this.main=t&&t.main?t.main:ShopCartConst.SELECTOR_ELEMENT_CART_AREA,this.notification=t&&t.notification?t.notification:ShopCartConst.SELECTOR_ELEMENT_CART_NOTIFICATION}}();t.ConfigSelectorElement=u;var l=function(){return function(t){void 0===t&&(t=null),this.active=t&&t.active?t.active:ShopCartConst.CLASS_ELEMENT_ACTIVE}}();t.ConfigSelectorClassElement=l}(ShopCart||(ShopCart={}));function getElemData(t,e){return t.dataset?t.dataset[e]:t.getAttribute(ShopCartConst.PREFIX_DATA+e)}!function(t){t.variantProductMap=[],t.productVariantsImageMap=[],t.variantMap=[];var e=function(){function e(e,i,n){if(void 0===i&&(i=null),void 0===n&&(n=null),!e)throw Error("Store configuration is missing");if(!i){if(!window.store)throw Error("Storage is missing");i=window.store}n||(n=window.store.get(ShopCartConst.STORAGE_CART)),this.dispatcher=new t.Dispatcher,this.dispatcher.init(),this.setConfig(e),this.storage=i,this.setUtm(),n=t.isValidCart(n)?new t.Cart(n.currency,n):new t.Cart(this.config.currency),this.cart=n,this.setTotal(),this.ready()}return e.prototype.getItem=function(e){var i=t.variantProductMap[e],n=t.variantMap[e];return e&&i&&n?new t.Item(e,i,n):null},e.prototype.setItem=function(t){var e=this.getItem(t);if(!e)return null;var i=this.cart.setItem(e);return this.dispatcher.add(t),this.openCart(),this.setTotal(),i},e.prototype.removeItem=function(t){var e=this.getItem(t);if(!e)return null;var i=this.cart.removeItem(e);return this.dispatcher.remove(t),this.setTotal(),i},e.prototype.getCheckoutUrl=function(){var t=this.config.store.url;"/"!=t[t.length-1]&&(t+="/");var e=t+"cart/";if(this.cart.quantity<=0)return null;for(var i=0;i<this.cart.items.length;i++)this.cart.items[i].quantity<=0||(e+=this.cart.items[i].item.upc+":"+this.cart.items[i].quantity+",");return this.utm&&this.utm.length>0&&(e+="?",this.utm.forEach(function(t){e+=t.key+"="+t.value+"&"})),e},e.prototype.openCart=function(){this.updateCartQuantities(),this.elementLoop(this.config.selector.cart.main,function(t,e){if(!(t.className.indexOf(e.config.selectorClass.cart.open)>=0)){t.className+=" "+e.config.selectorClass.cart.open;for(var i=0;i<e.cart.items.length;i++)if(e.cart.items[i].quantity>0)e.createCartItem(e.cart.items[i])}}),document.body.className.indexOf(this.config.selectorClass.body.cartOpen)<0&&(document.body.className+=" "+this.config.selectorClass.body.cartOpen,this.dispatcher.open())},e.prototype.elementLoop=function(t,e){for(var i=document.querySelectorAll(t),n=0;n<i.length;n++)e(i[n],this)},e.prototype.registerCartItemEvents=function(t){for(var e=t.querySelectorAll(ShopCartConst.SELECTOR_CART_ACTION),i=0;i<e.length;i++)this.registerCartActionEvent(e[i]),this.events[getElemData(e[i],ShopCartConst.DATA_UPC)+"-"+getElemData(e[i],ShopCartConst.DATA_ACTION)]=!0;e=t.querySelectorAll("input"+ShopCartConst.SELECTOR_ITEM_QUANTITY);for(i=0;i<e.length;i++)this.registerCartUpdateEvent(e[i])},e.prototype.registerCartUpdateEvent=function(t){var e=this;t.addEventListener("input",function(t){var i=t.target.value;if(i){var n=parseInt(i);if(isNaN(n))return;e.setItemQuantity(getElemData(t.target,ShopCartConst.DATA_UPC),n)}})},e.prototype.registerCartActionEvent=function(t){var e=this;this.events||(this.events={}),this.events[getElemData(t,ShopCartConst.DATA_UPC)]||(this.events[getElemData(t,ShopCartConst.DATA_UPC)+"-"+getElemData(t,ShopCartConst.DATA_ACTION)]=!0,t.addEventListener("click",function(t){var i=getElemData(t.target,ShopCartConst.DATA_UPC);switch(getElemData(t.target,ShopCartConst.DATA_ACTION)){case ShopCartConst.ACTION_ADD:e.setItem(i);e.updateCartQuantities();break;case ShopCartConst.ACTION_REMOVE:e.removeItem(i);e.updateCartQuantities()}}))},e.prototype.setItemQuantity=function(e,i){var n=this.getItem(e);if(!n)return null;var r=!1,a=0;return this.cart.items.map(function(t){return t.item.upc==e&&(t.quantity=i,r=!0,a=t.quantity),t}),r||(this.cart.items.push(new t.CartItem(n,i)),a=1),this.openCart(),this.setTotal(),a},e.prototype.createCartItem=function(t){if(t.quantity>0&&!document.getElementById(ShopCartConst.PREFIX_ITEM+t.item.upc)){var e=document.createElement("div");e.className=ShopCartConst.CLASS_ITEM,e.id=ShopCartConst.PREFIX_ITEM+t.item.upc,e.innerHTML=t.getTemplate(this.config),document.querySelector(ShopCartConst.SELECTOR_CART_ITEM_LIST).appendChild(e),this.registerCartItemEvents(e)}else this.updateItemQuantity(t)},e.prototype.updateCartQuantities=function(){for(var t=0;t<this.cart.items.length;t++)this.createCartItem(this.cart.items[t]),this.updateItemQuantity(this.cart.items[t])},e.prototype.updateItemQuantity=function(t){var e=document.querySelectorAll("#"+ShopCartConst.PREFIX_ITEM+t.item.upc),i=document.querySelectorAll("#"+ShopCartConst.PREFIX_ITEM+t.item.upc+" "+ShopCartConst.SELECTOR_ITEM_QUANTITY);if(i&&i.length>0){if(t.quantity<=0)return void document.querySelector(ShopCartConst.SELECTOR_CART_ITEM_LIST).removeChild(e[0]);for(var n=0;n<i.length;n++)i[n].value=t.quantity.toString()}},e.prototype.setTotal=function(){for(var t=0,e=0,i=0;i<this.cart.items.length;i++)t+=this.cart.items[i].item.product.price*this.cart.items[i].quantity,e+=this.cart.items[i].quantity>0?this.cart.items[i].quantity:0;return this.cart.total=t,this.cart.quantity=e,this.updateCartTotal(),this.updateCart(),t},e.prototype.setUtm=function(){this.utm=this.getUrlUtm(),this.utm&&this.utm.length>0?this.storage.set(ShopCartConst.STORAGE_UTM,this.utm):this.utm=this.getUtm()},e.prototype.getUtm=function(){return this.storage.get(ShopCartConst.STORAGE_UTM)},e.prototype.getUrlUtm=function(){var e=[],i=window.location.href.trim();if(i.indexOf("?")<0||i.indexOf("utm_")<0)return e;var n=i.split("?")[1],r=new RegExp("^utm_?[a-zA-Z0-9]*");return n.split("&").forEach(function(i){if(r.test(i)){var n=i.split("=");e.push(new t.Utm(n[0],n[1]))}}),e},e.prototype.updateCart=function(){this.storage.set(ShopCartConst.STORAGE_CART,this.cart),this.updateCartNotification(),this.updateCartCheckoutButton(),this.updateCartActive()},e.prototype.updateCartTotal=function(){for(var t=document.querySelectorAll(this.config.selector.cart.total),e=0;e<t.length;e++)t[e].innerHTML=this.cart.total.toFixed(2)+" "+this.cart.currency.label;for(t=document.querySelectorAll(this.config.selector.cart.count),e=0;e<t.length;e++)t[e].innerHTML=this.cart.quantity.toString()},e.prototype.updateCartCheckoutButton=function(){this.elementLoop(this.config.selector.cart.main,function(t,e){e.cart.quantity>0?(t.className=t.className.replace(e.config.selectorClass.cart.empty,"").trim(),e.setCartProductClass()):t.className.indexOf(e.config.selectorClass.cart.empty)<0&&(t.className+=" "+e.config.selectorClass.cart.empty)})},e.prototype.setCartProductClass=function(){this.elementLoop(this.config.selector.cart.main,function(e,i){for(var n=0;n<i.config.products.length;n++){var r=i.config.products[n].id;e.className=e.className.replace(r,"").trim()}for(n=0;n<i.cart.items.length;n++)if(i.cart.items[n].quantity>0){var a=t.variantProductMap[i.cart.items[n].item.upc];e.className.indexOf(a.id)<0&&(e.className+=" "+a.id)}})},e.prototype.updateCartActive=function(){this.elementLoop(this.config.selector.element.main,function(t,e){e.cart.quantity>0?t.className.indexOf(e.config.selectorClass.element.active)<0&&(t.className+=" "+e.config.selectorClass.element.active):t.className=t.className.replace(e.config.selectorClass.element.active,"").trim()})},e.prototype.updateCartNotification=function(){this.elementLoop(this.config.selector.element.notification,function(t,e){e.cart.quantity>0?(t.innerHTML=e.cart.quantity.toString(),t.className.indexOf(e.config.selectorClass.element.active)<0&&(t.className+=" "+e.config.selectorClass.element.active)):t.className=t.className.replace(e.config.selectorClass.element.active,"").trim()})},e.prototype.ready=function(){return this.dispatcher.ready(),document.body.className+=" "+this.config.selectorClass.body.cartReady},e.prototype.setConfig=function(e){if(!e.store||!e.store.url)throw Error("Store url is missing");this.config=new t.Config(e);for(var i=0;i<e.products.length;i++)for(var n=e.products[i],r=0;r<n.variants.length;r++)t.variantProductMap[n.variants[r].upc]=new t.Product(n.id,n.name,n.price,n.description,n.image.url),t.productVariantsImageMap[n.variants[r].upc]=new t.ProductImage(n.variants[r].image.url),t.variantMap[n.variants[r].upc]=new t.ProductVariant(n.variants[r].name,n.variants[r].upc,n.variants[r].sku,n.variants[r].size,n.variants[r].image.url)},e}();t.CartController=e}(ShopCart||(ShopCart={}));!function(t){var e=function(){return function(){}}();t.Currency=e}(ShopCart||(ShopCart={}));!function(t){var e=function(){function t(){this.polyfill(),this.addEvtRepo={},this.removeEvtRepo={},this.openEvt=this.createEvt(ShopCartConst.OPEN_EVT),this.closeEvt=this.createEvt(ShopCartConst.CLOSE_EVT),this.initEvt=this.createEvt(ShopCartConst.INIT_EVT),this.readyEvt=this.createEvt(ShopCartConst.READY_EVT)}return t.prototype.add=function(t){return this.addEvtRepo[t]||(this.addEvtRepo[t]=this.createEvt(ShopCartConst.ADD_EVT,t.toString())),window.dispatchEvent(this.addEvtRepo[t])},t.prototype.remove=function(t){return this.removeEvtRepo[t]||(this.removeEvtRepo[t]=this.createEvt(ShopCartConst.REMOVE_EVT,t.toString())),window.dispatchEvent(this.removeEvtRepo[t])},t.prototype.open=function(){if(this.openEvt)return window.dispatchEvent(this.openEvt)},t.prototype.close=function(){if(this.closeEvt)return window.dispatchEvent(this.closeEvt)},t.prototype.init=function(){if(this.initEvt)return window.dispatchEvent(this.initEvt)},t.prototype.ready=function(){if(this.readyEvt)return window.dispatchEvent(this.readyEvt)},t.prototype.createEvt=function(t,e){return void 0===e&&(e=null),new window.CustomEvent(t,{detail:e})},t.prototype.polyfill=function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t},t}();t.Dispatcher=e}(ShopCart||(ShopCart={}));!function(t){var e=function(){return function(t,e,i){this.upc=t,this.product=e,this.productvariant=i}}();t.Item=e;var i=function(){function e(t,e){void 0===e&&(e=0),this.item=t,this.quantity=e}return e.prototype.getTemplate=function(e){void 0===e&&(e=null);var i="",n=t.variantProductMap[this.item.upc],r=t.productVariantsImageMap[this.item.upc],a=e&&e.image&&e.image.basePath?e.image.basePath:"./images/";return i+="<table><tr>",i+='<td class="product-image">',r&&r.url&&(i+='<img src="'+a+r.url+'">'),i+="</td>",i+='<td class="product-details"><div class="product-name">'+n.name+"</div>",this.item.productvariant.name&&(i+='<div class="item-name">Color: '+this.item.productvariant.name+"</div>"),this.item.productvariant.size&&(i+='<div class="item-size">Size: '+this.item.productvariant.size+"</div>"),i+='<div class="input-group">',i+='<button class="minus '+ShopCartConst.CLASS_CART_ACTION+'" data-upc="'+this.item.upc+'" data-sku="'+this.item.productvariant.sku+'" data-product="'+n.name+'" data-price="'+n.price+'" data-label="'+this.item.productvariant.name+'" data-action="remove"></button>',i+='<input class="'+ShopCartConst.CLASS_ITEM_QUANTITY+' form-control hidden-xs"  min="0" type="text" value="'+this.quantity+'" data-upc="'+this.item.upc+'"></input>',i+='<input class="'+ShopCartConst.CLASS_ITEM_QUANTITY+' form-control visible-xs" disabled="disabled"  min="0" type="text" value="'+this.quantity+'" data-upc="'+this.item.upc+'"></input>',i+='<button class="plus '+ShopCartConst.CLASS_CART_ACTION+'" data-upc="'+this.item.upc+'" data-sku="'+this.item.productvariant.sku+'" data-product="'+n.name+'" data-price="'+n.price+'" data-label="'+this.item.productvariant.name+'" data-action="add"></button>',i+="</div></td>",i+='<td class="product-price">',i+='<div class="item-price">'+n.price.toFixed(2)+"</div>",i+="</td>",i+="</tr></table>"},e}();t.CartItem=i}(ShopCart||(ShopCart={}));!function(t){var e=function(){function t(t){this.url=t,this.setKey(this.url)}return t.prototype.setKey=function(t){if(t){var e=t.substring(t.lastIndexOf("/")+1),i=e.lastIndexOf(".");this.key=i>0?e.substr(0,i):e}},t}();t.ProductImage=e;var i=function(){return function(t,i,n,r,a){void 0===r&&(r=null),void 0===a&&(a=null),this.name=t,this.upc=i,this.sku=n,this.size=r,this.image=a?new e(a):null}}();t.ProductVariant=i;var n=function(){return function(t,i,n,r,a,o){void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null),this.id=t,this.name=i,this.price=n,this.description=r||"",this.image=a?new e(a):null,this.variants=o||[]}}();t.Product=n}(ShopCart||(ShopCart={}));var ShopCart;!function(t){var e=function(){return function(t,e){this.key=t,this.value=e}}();t.Utm=e}(ShopCart||(ShopCart={}));